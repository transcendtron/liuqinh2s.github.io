---
layout: post
title: git学习记录
categories: 技术教程
tags: [工具, git, 记录]
comments: true
---

git是由Linus Torvalds在开发linux内核时发明的一种软件版本控制工具，其实这就是一个文件版本控制工具，协同写作也可以用git，会十分方便，github就是用的git。git是分布式的版本控制系统，而SVN是集中式的版本控制系统（也就是星型网络，必须要有一个中央服务器）。

# 相关教程
[廖雪峰的Git教程](http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000)
[30分钟git命令入门到放弃\| w3cTrain](https://www.w3ctrain.com/2016/06/26/learn-git-in-30-minutes/)
[Git - Wikipedia](https://en.wikipedia.org/wiki/Git)
[Git官网](https://git-scm.com/)
[git 官方文档](https://git-scm.com/doc)
[图解git](https://marklodato.github.io/visual-git-guide/index-zh-cn.html)
[Try Git: Git Tutorial](https://try.github.io)
[Pro Git](https://git-scm.com/book/en/v2)
[Git Reference](http://gitref.org/)
[Code School Git 教程](https://www.codeschool.com/courses/git-real/)
[Codecadmy Git 教程](https://www.codecademy.com/learn/learn-git)
[githubguides](https://guides.github.com/activities/hello-world/)

#配置git
安装完git,首要任务是配置我们的信息，最重要的是用户名及邮箱，打开终端，执行以下命令。
```
git config --global user.name "My Name"w
git config --global user.email myEmail@example.com
```
配置好这两项，用户就能知道谁做了什么，并且一切都更有组织性了不是吗？

# 常用git命令
> 最常用的用红色字体标出了

- git init  //把当前目录变成一个带git版本控制的目录，简单的说就是变成git目录
- $\color{red}{git \ add \ .}$ //把所有修改过的东西都添加到git仓库，.表示当前目录
- git status    //看是否有改动还没有提交

其实git会自己有提示，如上图那个黄色的叉叉就表示有新的改动没有提交。
- git diff  file_name  //查看一个文件哪里被修改了
- git  commit  -m  “message”  //把添加的东西确认提交，并填写好确认信息（一般写上做了什么改动）
**这里要讲的一点就是要尽量少的使用这条命令，而尽量多的使用git add，因为git commit会提交到版本库的最终状态（快照）树中，并通过HEAD和branch来管理这些版本，每个状态都应该是一个值得记住的状态（快照）才对，如果你拼命的提交就会产生非常多的快照，这样非常不利于管理。所以不要把git commit当git add使，有什么改动都先git add到暂存区，最后有了大的变动和有意义的变动或者解决了某个问题，再git commit到状态（快照）树中。**
- git log //查看日志（回顾历史版本）
- git reflog    //查看日志（回顾所有版本，及版本切换操作）
- git reset \-\-hard HEAD^  //回退一个版本，HEAD代表当前版本，HEAD^表示上一个版本，HEAD^^表示上上个版本，当然往上100个版本写100个^比较容易数不过来，所以写成HEAD~100，当然也可以通过版本号回去。

如图是git log所输出的信息，commit后面跟着的就是版本号，按Q可以退出次界面。
- git checkout -- file_name     //撤销修改。
命令git checkout -- readme.txt意思就是，把readme.txt文件在工作区的修改全部撤销，这里有两种情况：
一种是readme.txt自修改后还没有被放到暂存区，现在，撤销修改就回到和版本库一模一样的状态；
一种是readme.txt已经添加到暂存区后，又作了修改，现在，撤销修改就回到添加到暂存区后的状态。
总之，就是让这个文件回到最近一次git commit或git add时的状态。
git checkout其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。


#远端仓库
为了能够协同开发，我们需要把代码发布到远端仓库上。
##链接远端仓库-git remote add
```
git remote add origin https://github.com/teasion/blog.git
```
一个项目可以同时拥有好几个远端仓库为了能够区分，通常会起不同的名字。通常主远端仓库被称为origin。

##上传到服务器-git push
每次我们要提交代码到服务器上时，都会使用到git push。
git push命令会有两个参数，远端仓库的名字，以及分支的名字：
```
git push origin gh-pages
```
push过程你可能需要验证身份。
为此我们可以添加SSH密钥到github上。
这里有篇相关教程：[git-ssh 配置和使用](https://segmentfault.com/a/1190000002645623)
##克隆仓库-git clone
放在Github上的开源项目，人们可以看到你的代码。可以使用 git clone进行下载到本地。
```
git clone https://github.com/teasion/blog.git
```
本地也会创建一个新的仓库，并自动将github上的分支设为远端分支。

##从服务器上拉取代码-git pull
```
git pull origin master
```
如果你更新了代码到仓库上，其他人可以通过git pull命令拉取你的变动

#分支讲解

当你在做一个新功能的时候，最好是在一个独立的区域上开发，通常称之为分支。分支之间相互独立，并且拥有自己的历史记录。这样做的原因是：
稳定版本的代码不会被破坏
不同的功能可以由不同开发者同时开发。
开发者可以专注于自己的分支，不用担心被其他人破坏了环境
在不确定之前，同一个特性可以拥有几个版本，便于比较
##创建新分支-git branch
每一个仓库的默认分支都叫master, 创建新分支可以这样：
```
git branch amazing_new_feature
```
创建了一个名为amazing_new_feature的新分支，它跟当前分支同一起点

单独使用git branch，可以查看分支状态：
```
$ git branch
  amazing_new_feature
* master
```
* 号表示当前活跃分支为master，使用git checkout切换分支。
##切换分支-git checkout
```
git checkout amazing_new_feature
```
##合并分支
我们的 amazing_new_feature 分支的任务是增加一个featuer.txt。我们来创建，添加到暂存区，提交。
```
$ git add feature.txt
$ git commit -m "New feature complete."
```
新分支任务完成了，回到master分支
```
git checkout master
```
现在去查看文件，你会发现，之前创建的feature.txt文件不见了，因为master分支上并没有feature.txt。使用git merge 把 amazing_new_feature 分支合并到master上。
```
git merge amazing_new_feature
```
ok! 然后再把amazing_new_feature 分支删掉吧。
```
git branch -d amazing_new_feature
```
#进阶操作
##比对两个不同提交之间的差别
每次提交都有一个唯一id，查看所有提交和他们的id，可以使用 git log:
查看某一次提交更新了什么，使用 git show 快照的ID（id 很长，但是你并不需要复制整个字符串，前一小部分就够了。）
查看两次提交的不同，可以使用git diff [commit-from]..[commit-to] 语法：
```
$ git diff 09bd8cc..ba25c0ff
diff --git a/feature.txt b/feature.txt
new file mode 100644
index 0000000..e69de29
diff --git a/hello.txt b/hello.txt
index e69de29..b546a21 100644
--- a/hello.txt
+++ b/hello.txt
@@ -0,0 +1 @@
+Nice weather today, isn't it?
```
比较首次提交和最后一次提交，我们可以看到所有的更改。当然使用git difftool命令更加方便。
##回滚某个文件到之前的版本
git 允许我们将某个特定的文件回滚到特定的提交，使用的也是 git checkout。
下面的例子，我们将hello.txt回滚到最初的状态，需要指定回滚到哪个提交，以及文件的全路径。
```
git checkout 09bd8cc1 hello.txt
```
##解决合并冲突
冲突经常出现在合并分支或者是拉去别人的代码。有些时候git能自动处理冲突，但大部分需要我们手动处理。
比如John 和 Tim 分别在各自的分支上写了两部分代码。
John 喜欢 for:
```
// Use a for loop to console.log contents.
for(var i=0; i<arr.length; i++) {
console.log(arr[i]);
}
```
Tim 喜欢 forEach:
```
// Use forEach to console.log contents.
arr.forEach(function(item) {
console.log(item);
});
```
假设John 现在去拉取 Tim的代码:
```
$ git merge tim_branch
Auto-merging print_array.js
CONFLICT (content): Merge conflict in print_array.js
Automatic merge failed; fix conflicts and then commit the result.
```
这时候git并不知道如何解决冲突，因为他不知道John和Tim谁写得更好。
于是它就在代码中插入标记。
```
<<<<<<< HEAD
// Use a for loop to console.log contents.
for(var i=0; i<arr.length; i++) {
    console.log(arr[i]);
}
=======
// Use forEach to console.log contents.
arr.forEach(function(item) {
    console.log(item);
});
>>>>>>> Tim s commit.
```
==== 号上方是当前最新一次提交，下方是冲突的代码。我们需要解决这样的冲突，经过组委会成员讨论，一致认定，在座的各位都是垃圾！两个都不要。改成下面的代码。
```
// Not using for loop or forEach.
// Use Array.toString() to console.log contents.
console.log(arr.toString());
```
好了，再提交一下：
```
$ git add -A
$ git commit -m "Array printing conflict resolved."
```
如果在大型项目中，这个过程可能容易出问题。你可以使用GUI 工具来帮助你。使用 git mergetool。
##配置.gitignore
大部分项目中，会有写文件，文件夹是我们不想提交的。为了防止一不小心提交，我们需要gitignore文件：
1. 在项目根目录创建.gitignore文件
2. 在文件中列出不需要提交的文件名，文件夹名，每个一行
3. .gitignore文件需要提交，就像普通文件一样

通常会被ignore的文件有：
- log文件
- task runner builds
- node_modules等文件夹
- IDEs生成的文件
- 个人笔记
例如：
```
*.log
build/
node_modules/
.idea/
my_notes.txt
```

#git概念和原理
**工作区（Working Directory）**，就是你电脑中能看到的目录。
**版本库（Repository）**，工作区有个隐藏目录.git，这个不算工作区，而是git的版本库。
Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支master，以及指向master的一个指针叫HEAD。

前面讲了我们把文件往Git版本库里添加的时候，是分两步执行的：
第一步是用git add把文件添加进去，实际上就是把文件修改添加到暂存区；
第二步是用git commit提交更改，实际上就是把暂存区的所有内容提交到当前分支。
因为我们创建Git版本库时，Git自动为我们创建了唯一一个master分支，所以，现在，git commit就是往master分支上提交更改。
你可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。
每次修改，如果不add到暂存区，那就不会加入到commit中。


#实用git工具
[在线创建.gitignore](https://www.gitignore.io/)
[git 官方文档](https://git-scm.com/doc)
